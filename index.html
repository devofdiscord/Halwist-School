<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Halwist School - تسجيل الدخول</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #000; color: #fff; text-align: center; margin:0; padding:0; }
        header { background: #66ccff; color:#000; padding:20px; position:relative; border-bottom:3px solid #fff; }
        header img { position:absolute; left:20px; top:10px; height:60px; }
        header h1 { margin:0; font-size:32px; }
        button { padding:12px 25px; font-size:18px; margin:20px; border:none; border-radius:5px; cursor:pointer; background:#66ccff; color:#000; }
        #status { margin-top:20px; font-size:18px; }
        .mode-btn { padding:8px 15px; margin:5px; font-size:16px; border-radius:4px; border:none; cursor:pointer; background:#0077cc; color:#fff; }
    </style>
</head>
<body>

<header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/School_icon.png/120px-School_icon.png" alt="شعار المدرسة">
    <h1>Halwist School</h1>
</header>

<button id="loginBtn">تسجيل الدخول بحساب GitHub</button>
<div id="status"></div>

<script>
const allowedUsers = ['devofdiscord']; // الحساب المسموح له بالدخول
const CLIENT_ID = 'Ov23liRCTZVnjDXXdRyz'; // ضع هنا Client ID الخاص بتطبيقك
const REDIRECT_URI = window.location.origin + window.location.pathname;

const loginBtn = document.getElementById('loginBtn');
const statusDiv = document.getElementById('status');

// تحديث حالة المستخدم بعد تسجيل الدخول
function updateStatus(user) {
    const visits = parseInt(localStorage.getItem(user.login+'_visits') || 0) + 1;
    localStorage.setItem(user.login+'_visits', visits);

    const now = new Date();
    localStorage.setItem(user.login+'_lastLogin', now.toISOString());

    const mode = localStorage.getItem('userMode') || 'غير محدد';

    statusDiv.innerHTML = `
        <p>مرحباً، ${user.login}</p>
        <p>عدد المرات التي دخلت بها الموقع: ${visits}</p>
        <p>آخر دخول: ${now.toLocaleString()}</p>
        <p>اختر وضعك:</p>
        <button class="mode-btn" onclick="setMode('visitor')">زائر</button>
        <button class="mode-btn" onclick="setMode('student')">طالب</button>
        <p>وضعك الحالي: <span id="mode">${mode}</span></p>
    `;
}

// تغيير وضع المستخدم
function setMode(mode){
    localStorage.setItem('userMode', mode);
    document.getElementById('mode').innerText = mode;
    alert(`تم اختيار وضع ${mode}`);
}

// زر تسجيل الدخول
loginBtn.addEventListener('click', () => {
    const oauthURL = `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&scope=read:user&redirect_uri=${REDIRECT_URI}`;
    window.location.href = oauthURL;
});

// بعد إعادة التوجيه من GitHub
const params = new URLSearchParams(window.location.search);
const code = params.get('code');
if(code){
    // ملاحظة: في موقع ثابت، لا يمكن تحويل code إلى access token مباشرة بدون backend
    // لذلك نستخدم هنا mock user للتجربة
    const mockUser = { login:'devofdiscord' }; // الحساب المسموح به
    if(!allowedUsers.includes(mockUser.login)){
        statusDiv.innerHTML = `<p>حسابك غير مسموح!</p>`;
    } else {
        updateStatus(mockUser);
    }
}
</script>

</body>
</html>
